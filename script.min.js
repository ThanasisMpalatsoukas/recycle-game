let CONFIG={speed:2e3,bin:{blue:[20,28],brown:[12,19],green:[1,11]},winningPoints:300,amountOfLosingEl:10};function RecycableCollection(){this.recycables=[],this.addRecycable=(e=>{this.recycables.push(e)}),this.find=(e=>{let t=-1;return this.recycables.map(n=>{n.key==e&&(t=n)}),t}),this.remove=(e=>{for(let t=0;t<this.recycables.length;t++)if(this.recycables[t].key==e)return void this.recycables.splice(t,1)}),this.removeAll=(()=>{this.recycables.map(e=>{e.deleteEl()}),this.recycables=[]})}function BinCollection(){this.bins=[],this.addBin=(e=>{this.bins.push(e)}),this.find=(e=>{let t=-1;return this.bins.map(n=>{n.key==e&&(t=n)}),t}),this.collides=(e=>{let t;return this.bins.map(n=>{doElsCollide(n.el,e)&&(t=n)}),t})}function Recycable(e,t,n,i,l){this.name=e,this.points=t,this.key=n,this.binKey=i,this.imgSrc=l,this.el="",this.id="k"+n,this.createEl=(()=>{let e=Math.floor(Math.random()*gameObjectEl.clientHeight),t=Math.floor(Math.random()*gameObjectEl.clientWidth),n=document.createElement("div");n.setAttribute("key",this.key),n.setAttribute("draggable",!0),n.setAttribute("ondragstart","dragStart(event);"),n.setAttribute("ontouchstart","mobileTouchStart(event);"),n.setAttribute("ontouchmove","mobileTouchMove(event);"),n.setAttribute("ontouchend","mobileTouchEnd(event);"),n.style.backgroundImage="url(./images/r"+this.imgSrc+".png)",n.style.backgroundSize="cover",n.style.backgroundPosition="center",n.classList=l+" object",n.style.top=e+"px",n.style.left=t+"px",this.el=n,gameObjectEl.appendChild(n)}),this.deleteEl=(()=>{""!=this.el&&gameObjectEl.removeChild(this.el)})}function Bin(e,t,n,i,l){this.name=e,this.key=t,this.el=l,this.alert=document.getElementById(n),this.alertFail=document.getElementById(i)}let gameObjectEl=document.getElementById("game-objects"),pointsShow=document.getElementById("points"),winningScreen=document.getElementById("winning-message"),losingScreen=document.getElementById("losing-message"),beginMessage=document.getElementById("begin-message"),timeSpan=document.getElementById("time"),binCollection=new BinCollection,recycableCollection=new RecycableCollection,allBins=document.getElementsByClassName("bin"),bin1=new Bin("bin1",0,"point-alert-bin-1","point-alert-lose-bin-1",allBins[0]),bin2=new Bin("bin2",1,"point-alert-bin-2","point-alert-lose-bin-2",allBins[1]),bin3=new Bin("bin3",2,"point-alert-bin-3","point-alert-lose-bin-3",allBins[2]),incremental=0,timeKeeper=0,timeKeeping=setInterval(()=>{timeKeeper++},1e3),interval=null;function startGame(){interval=setInterval(gameInterval,CONFIG.speed),beginMessage.style.display="none"}function triggerDrop(e,t=null){if(null==t&&(t=binCollection.find(e.currentTarget.getAttribute("key"))),t.key==currentRec.binKey){currentRec.deleteEl();let e=0;if(""!=pointsShow.innerHTML&&(e=parseInt(pointsShow.innerHTML)),e+=currentRec.points,t.alert.innerHTML=currentRec.points,pointsShow.innerHTML=e,t.alert.classList.add("appear"),parseInt(pointsShow.innerHTML)>=CONFIG.winningPoints){clearInterval(interval),clearInterval(timeKeeping);let e=computeSecondsAndMin(timeKeeper);timeSpan.innerHTML=e,winningScreen.style.display="flex",recycableCollection.removeAll()}recycableCollection.remove(currentRec.key),setTimeout(()=>{t.alert.classList.remove("appear")},500)}else{currentRec.deleteEl(),t.alertFail.innerHTML="-"+currentRec.points,t.alertFail.classList+=" appear",t.alertFail.classList.add("appear");let e=0;""!=pointsShow.innerHTML&&(e=parseInt(pointsShow.innerHTML)),e-=currentRec.points,pointsShow.innerHTML=e,recycableCollection.remove(currentRec.key),setTimeout(()=>{t.alertFail.classList.remove("appear")},500)}}binCollection.addBin(bin1),binCollection.addBin(bin2),binCollection.addBin(bin3);let points=0;function dragStart(e){currentRec=recycableCollection.find(e.currentTarget.getAttribute("key"))}function mobileTouchStart(e){currentRec=recycableCollection.find(e.currentTarget.getAttribute("key"))}function mobileTouchEnd(e){let t=binCollection.collides(currentRec.el);null!=t&&triggerDrop(e,t)}function mobileTouchMove(e){var t=e.targetTouches[0];currentRec.el.style.left=t.pageX+"px",currentRec.el.style.top=t.pageY+"px"}function triggerDragEnter(e){e.preventDefault()}function triggerDragOver(e){e.preventDefault()}function computeSecondsAndMin(e){let t=0;return e>60&&(e-=60*(t=Math.floor(e/60))),`${t}m ${e}s`}function randomNumbGenerator(e,t){return Math.floor(Math.random()*(t+1-e)+e)}function reStart(){restartGame(),interval=setInterval(gameInterval,CONFIG.speed),timeKeeping=setInterval(()=>{timeKeeper++},1e3)}function restartGame(){timeKeeper=0,RecycableCollection.recycable=[],pointsShow.innerHTML=0,winningScreen.style.display="none",losingScreen.style.display="none"}function gameInterval(){let e=Math.floor(3*Math.random());recycableCollection.recycables.length>CONFIG.amountOfLosingEl&&(clearInterval(interval),clearInterval(timeKeeping),losingScreen.style.display="flex",recycableCollection.removeAll());let t=0;t=0==e?randomNumbGenerator(CONFIG.bin.blue[0],CONFIG.bin.blue[1]):1==e?randomNumbGenerator(CONFIG.bin.brown[0],CONFIG.bin.brown[1]):randomNumbGenerator(CONFIG.bin.green[0],CONFIG.bin.green[1]);let n=new Recycable("w2",20,incremental,e,t);n.createEl(),recycableCollection.addRecycable(n),incremental++}doElsCollide=function(e,t){return e.offsetBottom=e.offsetTop+e.offsetHeight,e.offsetRight=e.offsetLeft+e.offsetWidth,t.offsetBottom=t.offsetTop+t.offsetHeight,t.offsetRight=t.offsetLeft+t.offsetWidth,!(e.offsetBottom<t.offsetTop||e.offsetTop>t.offsetBottom||e.offsetRight<t.offsetLeft||e.offsetLeft>t.offsetRight)},beginMessage.style.display="flex";